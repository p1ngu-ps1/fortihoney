<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FortiHoney Admin Panel | H4CK3R M0D3</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: #00ff00; font-family: 'Courier New', monospace; overflow-x: hidden; }
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.15; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; }
        .header { text-align: center; padding: 30px 0; border-bottom: 2px solid #00ff00; margin-bottom: 30px; text-shadow: 0 0 10px #00ff00; animation: flicker 3s infinite; }
        @keyframes flicker { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .header h1 { font-size: 36px; margin-bottom: 10px; letter-spacing: 3px; }
        .header .subtitle { color: #ff0000; font-size: 14px; text-transform: uppercase; letter-spacing: 2px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-box { background: linear-gradient(145deg, #0a0a0a, #1a1a1a); border: 2px solid #00ff00; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 0 20px rgba(0, 255, 0, 0.3); transition: all 0.3s; }
        .stat-box:hover { border-color: #ff0000; box-shadow: 0 0 30px rgba(255, 0, 0, 0.5); transform: scale(1.05); }
        .stat-box .value { font-size: 48px; color: #ff0000; margin: 10px 0; text-shadow: 0 0 10px #ff0000; }
        .stat-box .label { font-size: 14px; color: #00ff00; text-transform: uppercase; }
        .panel { background: #0a0a0a; border: 2px solid #00ff00; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 0 20px rgba(0, 255, 0, 0.2); }
        .panel-header { font-size: 20px; color: #ff0000; margin-bottom: 15px; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #00ff00; padding-bottom: 10px; }
        .log-entry { background: #000; border-left: 3px solid #00ff00; padding: 15px; margin-bottom: 10px; font-size: 12px; transition: all 0.3s; }
        .log-entry:hover { border-left-color: #ff0000; background: #0a0a0a; transform: translateX(5px); }
        .log-entry.suspicious { border-left-color: #ff0000; background: #1a0000; }
        .log-entry.cve-attempt { border-left-color: #ff00ff; background: #1a001a; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .log-time { color: #888; margin-right: 10px; }
        .log-ip { color: #00ffff; font-weight: bold; }
        .log-country { color: #ffff00; margin-left: 10px; }
        .log-event { color: #ff0000; font-weight: bold; margin-right: 10px; }
        .log-path { color: #00ff00; }
        .cve-badge { display: inline-block; background: #ff0000; color: #000; padding: 2px 8px; border-radius: 3px; font-weight: bold; margin-left: 10px; animation: blink 1s infinite; }
        @keyframes blink { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0.5; } }
        .controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        button, select { background: #000; color: #00ff00; border: 2px solid #00ff00; padding: 10px 20px; font-family: 'Courier New', monospace; font-size: 14px; cursor: pointer; transition: all 0.3s; text-transform: uppercase; }
        button:hover, select:hover { background: #00ff00; color: #000; box-shadow: 0 0 20px #00ff00; }
        button:active { transform: scale(0.95); }
        .loading { text-align: center; color: #00ff00; font-size: 18px; animation: flicker 1s infinite; }
        .top-list { list-style: none; }
        .top-list li { padding: 8px; border-bottom: 1px solid #0a3a0a; display: flex; justify-content: space-between; }
        .top-list li:hover { background: #0a3a0a; }
        .api-info { background: #1a1a00; border: 2px solid #ffff00; padding: 15px; margin-bottom: 20px; border-radius: 5px; font-size: 12px; }
        .api-info code { background: #000; color: #00ff00; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <canvas id="matrix-canvas"></canvas>

    <div class="container">
        <div class="header">
            <h1>üçØ FORTIHONEY ADMIN PANEL üçØ</h1>
            <div class="subtitle">‚ö†Ô∏è SYSTEM ACCESS GRANTED ‚ö†Ô∏è</div>
        </div>

        <div class="api-info">
            <strong style="color: #ffff00;">üîë API KEY:</strong>
            <code id="api-key">{{ api_key }}</code>
            <button onclick="copyApiKey()" style="margin-left: 10px; padding: 5px 10px;">COPY</button>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <div class="label">Total Events</div>
                <div class="value" id="stat-total">-</div>
            </div>
            <div class="stat-box">
                <div class="label">Login Attempts</div>
                <div class="value" id="stat-logins">-</div>
            </div>
            <div class="stat-box">
                <div class="label">CVE Attempts</div>
                <div class="value" id="stat-cves">-</div>
            </div>
            <div class="stat-box">
                <div class="label">Suspicious</div>
                <div class="value" id="stat-suspicious">-</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">‚ö° REAL-TIME LOGS ‚ö°</div>
            <div class="controls">
                <button onclick="loadLogs()">‚Üª REFRESH</button>
                <button onclick="toggleAutoRefresh()">‚è± AUTO-REFRESH: <span id="auto-status">OFF</span></button>
                <select id="event-filter" onchange="loadLogs()">
                    <option value="">ALL EVENTS</option>
                    <option value="login_attempt">LOGIN ATTEMPTS</option>
                    <option value="cve_2018_13379_attempt">CVE ATTEMPTS</option>
                    <option value="path_probe">PATH PROBES</option>
                    <option value="api_cmdb_request">API REQUESTS</option>
                </select>
                <select id="log-limit" onchange="loadLogs()">
                    <option value="50">50 LOGS</option>
                    <option value="100" selected>100 LOGS</option>
                    <option value="200">200 LOGS</option>
                    <option value="500">500 LOGS</option>
                </select>
            </div>
            <div id="logs-container">
                <div class="loading">‚è≥ LOADING LOGS...</div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="panel">
                <div class="panel-header">üåç TOP ATTACKING IPs</div>
                <ul class="top-list" id="top-ips">
                    <li>Loading...</li>
                </ul>
            </div>

            <div class="panel">
                <div class="panel-header">üö© TOP COUNTRIES</div>
                <ul class="top-list" id="top-countries">
                    <li>Loading...</li>
                </ul>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">üìä EVENT TYPES</div>
            <ul class="top-list" id="event-types">
                <li>Loading...</li>
            </ul>
        </div>

        <div class="panel">
            <div class="panel-header">üéØ CVE ATTEMPTS</div>
            <ul class="top-list" id="cve-attempts">
                <li>No CVE attempts detected yet...</li>
            </ul>
        </div>
    </div>

    <script>
        const API_KEY = '{{ api_key }}';
        let autoRefreshInterval = null;
        let autoRefreshEnabled = false;

        // Matrix rain effect
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#00ff00';
            ctx.font = fontSize + 'px monospace';
            for (let i = 0; i < drops.length; i++) {
                const text = String.fromCharCode(0x30A0 + Math.random() * 96);
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 50);

        async function apiRequest(endpoint) {
            const response = await fetch(\`/api/v1/\${endpoint}\`, {
                headers: { 'Authorization': \`Bearer \${API_KEY}\` }
            });
            return response.json();
        }

        async function loadStats() {
            try {
                const stats = await apiRequest('stats');
                document.getElementById('stat-total').textContent = stats.total_events || 0;
                document.getElementById('stat-logins').textContent = stats.event_types.login_attempt || 0;
                const cveTotal = Object.values(stats.cve_attempts || {}).reduce((a, b) => a + b, 0);
                document.getElementById('stat-cves').textContent = cveTotal;
                document.getElementById('stat-suspicious').textContent = stats.suspicious_requests || 0;

                const topIpsHtml = Object.entries(stats.top_ips)
                    .map(([ip, count]) => \`<li><span style="color: #00ffff">\${ip}</span><span style="color: #ff0000">\${count} hits</span></li>\`)
                    .join('');
                document.getElementById('top-ips').innerHTML = topIpsHtml || '<li>No data yet</li>';

                const topCountriesHtml = Object.entries(stats.top_countries)
                    .map(([country, count]) => \`<li><span style="color: #ffff00">\${country}</span><span style="color: #ff0000">\${count} hits</span></li>\`)
                    .join('');
                document.getElementById('top-countries').innerHTML = topCountriesHtml || '<li>No data yet</li>';

                const eventTypesHtml = Object.entries(stats.event_types)
                    .map(([type, count]) => \`<li><span style="color: #00ff00">\${type}</span><span style="color: #ff0000">\${count}</span></li>\`)
                    .join('');
                document.getElementById('event-types').innerHTML = eventTypesHtml || '<li>No events yet</li>';

                if (stats.cve_attempts && Object.keys(stats.cve_attempts).length > 0) {
                    const cveHtml = Object.entries(stats.cve_attempts)
                        .map(([cve, count]) => \`<li><span style="color: #ff00ff; font-weight: bold">\${cve}</span><span style="color: #ff0000">\${count} attempts ‚ö†Ô∏è</span></li>\`)
                        .join('');
                    document.getElementById('cve-attempts').innerHTML = cveHtml;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadLogs() {
            const eventType = document.getElementById('event-filter').value;
            const limit = document.getElementById('log-limit').value;
            let url = \`logs?limit=\${limit}\`;
            if (eventType) url += \`&event_type=\${eventType}\`;

            try {
                const data = await apiRequest(url);
                const logsHtml = data.logs.map(log => {
                    const time = new Date(log.timestamp).toLocaleString();
                    const isSuspicious = log.suspicious ? ' suspicious' : '';
                    const hasCve = log.cve_attempts && log.cve_attempts.length > 0;
                    const cveClass = hasCve ? ' cve-attempt' : '';
                    let cvesBadges = '';
                    if (hasCve) {
                        cvesBadges = log.cve_attempts.map(cve => \`<span class="cve-badge">\${cve.cve_id}</span>\`).join('');
                    }
                    return \`
                        <div class="log-entry\${isSuspicious}\${cveClass}">
                            <span class="log-time">\${time}</span>
                            <span class="log-event">[\${log.event_type.toUpperCase()}]</span>
                            <span class="log-ip">\${log.ip}</span>
                            <span class="log-country">\${log.country}</span>
                            <span class="log-path">\${log.method} \${log.path}</span>
                            \${cvesBadges}
                            \${log.username ? \`<br><span style="color: #ff00ff">‚Üí User: \${log.username}</span>\` : ''}
                            \${log.password ? \`<span style="color: #ff00ff"> | Pass: \${log.password}</span>\` : ''}
                            \${log.query_string ? \`<br><span style="color: #ffff00">‚Üí Query: \${log.query_string}</span>\` : ''}
                        </div>
                    \`;
                }).join('');
                document.getElementById('logs-container').innerHTML = logsHtml || '<div class="loading">NO LOGS FOUND</div>';
            } catch (error) {
                document.getElementById('logs-container').innerHTML = '<div class="loading" style="color: #ff0000;">ERROR LOADING LOGS</div>';
            }
        }

        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const statusEl = document.getElementById('auto-status');
            if (autoRefreshEnabled) {
                statusEl.textContent = 'ON';
                statusEl.style.color = '#00ff00';
                autoRefreshInterval = setInterval(() => { loadLogs(); loadStats(); }, 5000);
            } else {
                statusEl.textContent = 'OFF';
                statusEl.style.color = '#ff0000';
                if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            }
        }

        function copyApiKey() {
            navigator.clipboard.writeText(document.getElementById('api-key').textContent)
                .then(() => alert('API KEY COPIED TO CLIPBOARD'));
        }

        loadLogs();
        loadStats();
        setInterval(loadStats, 10000);
    </script>
</body>
</html>
